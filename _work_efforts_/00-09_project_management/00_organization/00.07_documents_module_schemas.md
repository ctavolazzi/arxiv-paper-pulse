# Work Effort: Documents Module Input/Output Schemas

## Status: Completed
**Started:** 2025-11-01 21:01
**Last Updated:** 2025-11-01 21:01

## Objective
Build out comprehensive input/output schemas for a NEW documents module using the Gemini API. The module supports processing PDF documents with multiple input sources, processing methods, and output formats, including structured output capabilities.

## Tasks
1. ✅ Create comprehensive input schemas (URL, file path, bytes, base64, multiple documents)
2. ✅ Create comprehensive output schemas (text, structured, transcription, metadata)
3. ✅ Create processing configuration schemas (method, format, options)
4. ✅ Implement DocumentProcessor class with inline and File API support
5. ✅ Support structured output with Pydantic models
6. ✅ Support enum values for structured output
7. ✅ Implement automatic method selection based on file size
8. ✅ Support multiple documents processing

## Progress

### Input Schemas Created
- **DocumentFromURL**: Document source from URL
- **DocumentFromPath**: Document source from local file path (with validation)
- **DocumentFromBytes**: Document source from bytes (inline processing, <20MB with validation)
- **DocumentFromBase64**: Document source from base64 (inline processing, <20MB with validation)
- **DocumentInput**: Single document input wrapper supporting all source types
- **MultipleDocumentsInput**: Multiple documents input for batch processing (1-1000 pages)

### Processing Configuration Schemas Created
- **ProcessingMethod**: Enum (AUTO, INLINE, FILE_API)
- **OutputFormat**: Enum (TEXT, STRUCTURED, TRANSCRIPTION)
- **DocumentProcessingConfig**: Comprehensive configuration including:
  - Processing method selection
  - Output format selection
  - Model selection
  - Prompt customization
  - Streaming support
  - File processing wait options
  - Structured output schema configuration
  - Response MIME type configuration

### Output Schemas Created
- **FileMetadata**: Metadata about uploaded/processed file (name, URI, state, size, MIME type, display name)
- **DocumentProcessingResult**: Result from processing single document (success, text, structured_data, transcription, metadata, error, method_used)
- **MultipleDocumentsResult**: Result from processing multiple documents (results list, combined outputs, success/failure counts)
- **DocumentProcessingError**: Error information schema

### Implementation Details
- **DocumentProcessor Class**: Main processor with methods:
  - `process()`: Process single document
  - `process_multiple()`: Process multiple documents together
  - Automatic method selection based on file size
  - Support for inline processing (<20MB)
  - Support for File API processing (>=20MB, up to 50MB)
  - Streaming response support
  - Structured output with Pydantic models
  - File processing status waiting

## Files Created
- `arxiv_paper_pulse/documents.py` - Complete documents module with all schemas and processor implementation

## Key Features

### Input Source Support
1. **URL**: Fetch PDFs from URLs
2. **Local Path**: Process local PDF files with path validation
3. **Bytes**: Direct byte input for inline processing (<20MB)
4. **Base64**: Base64 encoded string input for inline processing (<20MB)

### Processing Methods
1. **AUTO**: Automatically choose method based on file size
2. **INLINE**: Direct processing for files <20MB (no File API upload)
3. **FILE_API**: Upload to File API for files >=20MB (up to 50MB limit)

### Output Formats
1. **TEXT**: Plain text output (default)
2. **STRUCTURED**: JSON structured output with Pydantic model support
3. **TRANSCRIPTION**: HTML transcription preserving layout and formatting

### Structured Output Support
- Supports Pydantic models for structured JSON output
- Supports enum values for single-choice outputs
- Configurable response MIME types (`application/json`, `text/x.enum`)
- Automatic parsing of Pydantic models from responses

### Error Handling
- Comprehensive error schemas
- Size validation for inline processing
- Path validation for local files
- File processing status monitoring
- Timeout handling for file processing

## Schema Design Principles
1. **Direct and Minimal**: No unnecessary abstractions, inline logic where appropriate
2. **Comprehensive Validation**: Pydantic validators for size limits, path existence, base64 validity
3. **Flexible Configuration**: Optional fields with sensible defaults
4. **Type Safety**: Full type hints with Union types for multiple input sources
5. **Clear Separation**: Input, configuration, output, and error schemas clearly separated

## Next Steps
1. Integration with API endpoints
2. Integration with CLI commands
3. Add usage examples and documentation
4. Create tests for the documents module

## Notes
- Module follows the coding style guide (direct, minimal, inline when appropriate)
- All schemas use Pydantic with `ConfigDict(extra='forbid')` for strict validation
- File size limits: 20MB for inline, 50MB for File API
- Maximum pages: 1000 pages per document (Gemini limit)
- File API files are stored for 48 hours

